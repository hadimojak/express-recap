services:
  # kafka:
  #   image: apache/kafka:3.7.0
  #   container_name: kafka
  #   ports:
  #     - "9092:9092"
  #     - "9094:9094"
  #   environment:
  #     # KRaft settings
  #     KAFKA_NODE_ID: 1
  #     KAFKA_PROCESS_ROLES: broker,controller
  #     KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka:9093
  #     KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
  #     # Listener settings
  #     KAFKA_LISTENERS: PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://:9094
  #     KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,EXTERNAL://localhost:9094
  #     KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
  #     KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
  #     # Cluster settings
  #     CLUSTER_ID: MkU3OEVBNTcwNTJENDM2Qk
  #     KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
  #   volumes:
  #     - kafka_data:/var/lib/kafka/data

  # kafka-ui:
  #   image: provectuslabs/kafka-ui:latest
  #   container_name: kafka-ui
  #   depends_on:
  #     - kafka
  #   ports:
  #     - "8081:8080"
  #   environment:
  #     KAFKA_CLUSTERS_0_NAME: local
  #     KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:9092

  # elasticsearch:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
  #   container_name: elasticsearch
  #   ports:
  #     - "9200:9200"
  #     - "9300:9300"
  #   environment:
  #     - discovery.type=single-node
  #     - xpack.security.enabled=true
  #     - ELASTIC_PASSWORD=mojak2525
  #     - KIBANA_SYSTEM_PASSWORD=mojak2525
  #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  #   volumes:
  #     - elasticsearch_data:/usr/share/elasticsearch/data
  #   healthcheck:
  #     test:
  #       [
  #         "CMD-SHELL",
  #         "curl -f -u elastic:mojak2525 http://localhost:9200/_cluster/health || exit 1",
  #       ]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5

  # kibana:
  #   image: docker.elastic.co/kibana/kibana:8.11.0
  #   container_name: kibana
  #   ports:
  #     - "5601:5601"
  #   environment:
  #     - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
  #     - ELASTICSEARCH_USERNAME=kibana_system
  #     - ELASTICSEARCH_PASSWORD=mojak2525
  #     - ELASTICSEARCH_SSL_VERIFICATIONMODE=none
  #     - SERVERNAME=kibana
  #     - SERVER_HOST=0.0.0.0
  #     - XPACK_SECURITY_ENABLED=true
  #     - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=min32charlongencryptionkeyhere123456
  #     - XPACK_REPORTING_KIBANASERVER_HOSTNAME=localhost
  #     - XPACK_APM_ENABLED=false
  #     - XPACK_SCREENSHOTTING_BROWSER_CHROMIUM_DISABLESANDBOX=true
  #   depends_on:
  #     elasticsearch:
  #       condition: service_healthy
  #   healthcheck:
  #     test: ["CMD-SHELL", "curl -f http://localhost:5601/api/status || exit 1"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 10
  #     start_period: 60s

  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse
    ports:
      - "9000:9000" # ClickHouse native
      - "8123:8123" # ClickHouse HTTP
    volumes:
      - clickhouse_data:/var/lib/clickhouse
    ulimits:
      nofile:
        soft: 262144
        hard: 262144
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:8123/ping",
        ]
      interval: 30s
      timeout: 10s
      retries: 5

  signoz-query-service:
    image: signoz/query-service:latest
    container_name: signoz-query-service
    ports:
      - "8080:8080" # Query service
      - "4317:4317" # OTLP gRPC
      - "4318:4318" # OTLP HTTP
    environment:
      - SIGNOZ_TELEMETRYSTORE_CLICKHOUSE_DSN=tcp://clickhouse:9000
      - SIGNOZ_TELEMETRYSTORE_PROVIDER=clickhouse
      - SIGNOZ_LOCAL_DB_PATH=/var/lib/signoz/signoz.db
      - DISABLE_AUTHENTICATION=true
    volumes:
      - signoz_data:/var/lib/signoz
    depends_on:
      clickhouse:
        condition: service_healthy
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:8080/api/v1/health",
        ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

  signoz-frontend:
    image: signoz/frontend:latest
    container_name: signoz-frontend
    ports:
      - "3301:3301" # SigNoz UI
    environment:
      - REACT_APP_BASE_API=http://localhost:8080
      - REACT_APP_PREFERENCE_DOMAIN=http://localhost:3301
    depends_on:
      signoz-query-service:
        condition: service_healthy
    healthcheck:
      test:
        [
          "CMD",
          "wget",
          "--no-verbose",
          "--tries=1",
          "--spider",
          "http://localhost:3301",
        ]
      interval: 30s
      timeout: 10s
      retries: 5

  # redis:
  #   image: redis:7-alpine
  #   container_name: redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis_data:/data
  #   healthcheck:
  #     test: ["CMD", "redis-cli", "ping"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5

  # redis2:
  #   image: redis:7-alpine
  #   container_name: redis2
  #   ports:
  #     - "6380:6379"
  #   command: redis-server --requirepass e17991d3e55363f64791e5481e848cd9
  #   volumes:
  #     - redis2_data:/data
  #   healthcheck:
  #     test:
  #       ["CMD", "redis-cli", "-a", "e17991d3e55363f64791e5481e848cd9", "ping"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5

  # postgres:
  #   image: postgres:15-alpine
  #   container_name: postgres
  #   ports:
  #     - "26257:5432"
  #   environment:
  #     - POSTGRES_USER=sgmnt_master
  #     - POSTGRES_PASSWORD=uEaAMLzn6fZ2EkRc
  #     - POSTGRES_DB=sgmnt_ref_core
  #   command: postgres -c ssl=off
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U sgmnt_master"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5

volumes:
  kafka_data:
  elasticsearch_data:
  redis_data:
  redis2_data:
  postgres_data:
  clickhouse_data:
  signoz_data:
